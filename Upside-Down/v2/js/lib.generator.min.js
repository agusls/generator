var forwardTimeout,backwardTimeout;$(document).ready(function(){$("#english-text").focus(),$(".translate-container .english").on("input",function(e){clearTimeout(forwardTimeout),forwardTimeout=setTimeout(function(){var e=translate($("#english-text").val());$("#ghetto-text").val(e)},200)}),$(".translate-container .ghetto").on("input",function(e){clearTimeout(backwardTimeout),backwardTimeout=setTimeout(function(){translate($("#ghetto-text").val(),"backward")},200)}),$(".translate-container .english").keypress(function(e){32==e.which&&$("#english-text").val()}),$("#random-sentence").click(function(){$("#english-text").val(randomSentences[Math.floor(randomSentences.length*Math.random())]+" "+randomSentences[Math.floor(randomSentences.length*Math.random())]);var e=translate($("#english-text").val());$("#ghetto-text").val(e)})});var phrases1=new Array,phrases2=new Array,words1=new Array,words2=new Array,intraword1=new Array,intraword2=new Array,prefixes1=new Array,prefixes2=new Array,suffixes1=new Array,suffixes2=new Array,regex1=new Array,regex2=new Array,rev_regex1=new Array,rev_regex2=new Array,ordering1=new Array,ordering2=new Array;function numRules(){return phrases1.length+phrases2.length+words1.length+words2.length+intraword1.length+intraword2.length+prefixes1.length+prefixes2.length+suffixes1.length+suffixes2.length+regex1.length+regex2.length+rev_regex1.length+rev_regex2.length+ordering1.length+ordering2.length}var worker,doneToken="����}�",sentenceCount=0,useWebWorker=!1;function translate(e,r){if("backward"===r&&reverseIsDisabled)return $("#english-text").val();if(!(useWebWorker||"function"!=typeof forward&&numRules()>1e3)){if(""==e)return"";var t="";if(0!==[].concat(phrases1,phrases2,words1,words2,intraword1,intraword2,prefixes1,prefixes2,suffixes1,suffixes2,regex1,regex2,rev_regex1,rev_regex2,ordering1,ordering2).join("").length){sentenceCount=0,sentenceArray=e.split(/(\.)/g),sentenceArray=sentenceArray.filter(function(e){return""!==e});for(var n=0;n<sentenceArray.length;n++)if("."!==(e=sentenceArray[n]))if(""!==e.trim()){var a=!1;" "===e[0]&&(a=!0);var o=!1;e.trim()[0]===e.trim()[0].toUpperCase()&&(o=!0),"backward"==r?(e=(e=(e=" "+(e=intrawordSwap(intraword2,intraword1,e))+" ").toLowerCase()).split("\n").join(" 985865568NEWLINETOKEN98758659 "),e=phraseSwap(phrases2,phrases1,e),e=wordSwap(words2,words1,e),e=prefixSwap(prefixes2,prefixes1,e),e=(e=(e=removeDoneTokens(e=suffixSwap(suffixes2,suffixes1,e))).split(doneToken).join("")).trim(),e=regexReplace(rev_regex1,rev_regex2,e),e=wordOrdering(ordering2,ordering1,e)):(e=(e=(e=" "+(e=intrawordSwap(intraword1,intraword2,e))+" ").toLowerCase()).split("\n").join(" 985865568NEWLINETOKEN98758659 "),e=phraseSwap(phrases1,phrases2,e),e=wordSwap(words1,words2,e),e=prefixSwap(prefixes1,prefixes2,e),e=(e=(e=removeDoneTokens(e=suffixSwap(suffixes1,suffixes2,e))).split(doneToken).join("")).trim(),e=regexReplace(regex1,regex2,e),e=wordOrdering(ordering1,ordering2,e)),e=(e=(e=(e=e.split(" 985865568NEWLINETOKEN98758659 ").join("\n")).split(" 985865568NEWLINETOKEN98758659").join("\n")).split("985865568NEWLINETOKEN98758659").join("\n")).replace(/(\b\S+\b)[ ]+\b\1\b/gi,"$1 $1"),o&&(e=e[0].toUpperCase()+e.substr(1)),a&&(e=" "+e),t+=e,sentenceCount++}else t+=e;else t+=".";t=t.split("{{*DUPLICATE MARKER*}}").join(""),"undefined"!=typeof doApplySentenceCase&&!1!==doApplySentenceCase&&(t=capitalizeFirstLetter(t=applySentenceCase(t)))}else t=e;return"backward"==r&&"function"==typeof backward?t=backward(t):"function"==typeof forward&&(t=forward(t)),t}translateWithWebWorker(e,r)}var workerStarted=!1,waitingForTypingToFinish=!1,translationInQueue=!1,queuedTranslationDirection=!1,translationInProgress=!1,workerInitStarted=!1,ghettoPlaceholderText=document.querySelector("#ghetto-text").getAttribute("placeholder"),englishPlaceholderText=document.querySelector("#english-text").getAttribute("placeholder");function translateWithWebWorker(e,r){if("backward"===r?($("#english-text").css("background-image","url(/img/loading_nice.gif)"),$("#english-text").attr("placeholder","")):($("#ghetto-text").css("background-image","url(/img/loading_nice.gif)"),$("#ghetto-text").attr("placeholder","")),workerStarted){if(translationInProgress)return translationInQueue=!0,void(queuedTranslationDirection=r);waitingForTypingToFinish&&clearTimeout(waitingForTypingToFinish),waitingForTypingToFinish=setTimeout(function(){translationInProgress=!0,waitingForType=!1,worker.postMessage({text:e,direction:r})},350)}else translationInQueue=!0,queuedTranslationDirection=r,startWorker()}function startWorker(){if(workerInitStarted)return!1;workerInitStarted=!0,(worker=new Worker("/js/translate_worker.js?v=98483")).postMessage({startEvent:!0,phrases1:phrases1,phrases2:phrases2,words1:words1,words2:words2,intraword1:intraword1,intraword2:intraword2,prefixes1:prefixes1,prefixes2:prefixes2,suffixes1:suffixes1,suffixes2:suffixes2,regex1:regex1,regex2:regex2,rev_regex1:rev_regex1,rev_regex2:rev_regex2,ordering1:ordering1,ordering2:ordering2}),worker.addEventListener("message",function(e){workerStarted||(workerStarted=!0),e.data.startEvent||("backward"===e.data.direction?$("#english-text").val(e.data.text):$("#ghetto-text").val(e.data.text)),translationInProgress=!1,"backward"===e.data.direction?($("#english-text").css("background-image","none"),$("#english-text").attr("placeholder",englishPlaceholderText)):($("#ghetto-text").css("background-image","none"),$("#ghetto-text").attr("placeholder",ghettoPlaceholderText)),translationInQueue&&(translateWithWebWorker($("#english-text").val(),queuedTranslationDirection),queuedTranslationDirection=!1,translationInQueue=!1)},!1)}function applySentenceCase(e){return e.replace(/.+?[\.\?\!](\s|$)/g,function(e){return null!==e.charAt(0).match(/[a-z]/g)?e.charAt(0).toUpperCase()+e.substr(1):e})}function capitalizeFirstLetter(e){return null!==e.charAt(0).match(/[a-z]/g)?e.charAt(0).toUpperCase()+e.slice(1):e}function phraseSwap(e,r,t){for(var n=new Array(" ",",",".","'","!",":","?",'"',";","/","<",">",")","(","%","$"),a=(r=makeArrayClone(r),0);a<r.length;a++)r[a]=tokenate(r[a]);for(a=0;a<e.length;a++)for(var o=0;o<n.length;o++)t=""!==r[a]?t.split(" "+e[a].toLowerCase()+n[o]).join(" "+r[a]+n[o]):t.split(" "+e[a].toLowerCase()+n[o]).join(" ");return t}function wordSwap(e,r,t){var n=new Array(" ",",",".","'","!",":","?",'"',";","/","<",">",")","(","%","$");t=t.replace(/(\b\S+\b)\s+\b\1\b/i,"$1  $1"),r=makeArrayClone(r);for(var a=0;a<r.length;a++)r[a]=tokenate(r[a]);var o=[];for(a=0;a<e.length;a++)if(e[a]instanceof Array){o[a]=[];for(var i=0;i<e[a].length;i++)o[a][i]=e[a][i].replace(/\{\{.*\}\}/g,"")}else o[a]=e[a].replace(/\{\{.*\}\}/g,"");for(a=0;a<o.length;a++){if(r[a]instanceof Array){r[a].length;var s=r[a][Math.floor(Math.random()*r[a].length)]}else s=r[a];for(i=0;i<n.length;i++)if(o[a]instanceof Array)for(var l=0;l<o[a].length;l++)t=s.length>0?t.split(" "+o[a][l].toLowerCase()+n[i]).join(" "+s+n[i]):t.split(" "+o[a][l].toLowerCase()+n[i]).join(" ");else t=o[a][0]+o[a].slice(-1)=="''"||o[a][0]+o[a].slice(-1)=='""'?t.split(o[a].toLowerCase()+n[i]).join(s+n[i]):s.length>0?t.split(" "+o[a].toLowerCase()+n[i]).join(" "+s+n[i]):t.split(" "+e[a].toLowerCase()+n[i]).join(" ")}return t}function intrawordSwap(e,r,t){for(var n=0,a="",o="",i=0;i<t.length+1;i++){a=t.substring(n,i);for(var s=0;s<e.length;s++)if(-1!==a.indexOf(e[s])){o+=a.replace(e[s],r[s]),n=i;break}}return o+=t.substring(n,i)}function escapeRegex(e){return e.replace(/([()[{*+.$^\\|?])/g,"\\$1")}function prefixSwap(e,r,t){r=makeArrayClone(r);for(var n=0;n<r.length;n++)r[n]=tokenate(r[n]);for(n=0;n<e.length;n++)t=t.replace(new RegExp("\\s"+escapeRegex(e[n])+"([^\\s])","g")," "+r[n]+"$1");return t}function suffixSwap(e,r,t){r=makeArrayClone(r);for(var n=0;n<r.length;n++)r[n]=tokenate(r[n]);for(n=0;n<e.length;n++)t=t.replace(new RegExp("([^\\s])"+escapeRegex(e[n])+"\\s","g"),"$1"+r[n]+" ");return t}function regexReplace(e,r,t){for(var n=0;n<e.length;n++)if("string"==typeof r[0]||r[0]instanceof String){var a=e[n].match(new RegExp("^/(.*?)/([gimy]*)$"));if(a){var o=new RegExp(a[1],a[2]);t=t.replace(o,r[n])}}return t}function wordOrdering(e,r,t){for(var n=0;n<e.length;n++){var a=new RegExp("([^\\s]+){{"+e[n].trim().replace(/[\s]+/g," ").split(" ").join("}}[\\s]+([^\\s]+){{")+"}}","g"),o=getRelativeOrder(e[n].replace(/[\s]+/g," ").split(" "),r[n].replace(/[\s]+/g," ").split(" "));t=t.replace(a,"$"+o.split(",").join(" $"))}var i=[];for(n=0;n<e.length;n++)for(var s=e[n].trim().replace(/[\s]+/g," ").split(" "),l=0;l<s.length;l++)-1===i.indexOf(s[l])&&(t=t.replace("{{"+s[l]+"}}",""),i.push(s[l]));return t}function getRelativeOrder(e,r){for(var t=[],n=0;n<r.length;n++)-1!==e.indexOf(r[n])&&t.push(e.indexOf(r[n])+1);return t.join(",")}function removeDoneTokens(e){return e.split(doneToken).join("")}function tokenate(e){if("[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<e.length;r++)e[r]=doneToken+e[r].toString().split("").join(doneToken)+doneToken;return e}return doneToken+e.toString().split("").join(doneToken)+doneToken}function handleDuplicates(e,r){for(var t=e.length,n=0;n<t;n++){var a=e[n],o=new Array,i=!1;if("{{*DUPLICATE MARKER*}}"!=a.substring(0,"{{*DUPLICATE MARKER*}}".length))for(var s=0;s<t;s++)a==e[s]&&n!=s&&(o.push(r[s]),e[n]="{{*DUPLICATE MARKER*}}"+e[n],e[s]="{{*DUPLICATE MARKER*}}"+e[s],i=!0);i&&(o.push(r[n]),e.push(a),r.push(o))}for(n=0;n<e.length;n++)"{{*DUPLICATE MARKER*}}"===e[n].substring(0,"{{*DUPLICATE MARKER*}}".length)&&(0==n?(e.shift(),r.shift(),n--):(e.splice(n,1),r.splice(n,1)));return new Array(e,r)}function makeArrayClone(e){var r=e instanceof Array?[]:{};for(i in e)"clone"!=i&&(e[i]&&"object"==typeof e[i]?r[i]=makeArrayClone(e[i]):r[i]=e[i]);return r}window.setInterval(function(){},500);